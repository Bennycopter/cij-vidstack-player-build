import{o as r,E as c,l as a,D as u,n as h}from"../chunks/vidstack-B8Kcr51E.js";import{n,o,p as d}from"../chunks/vidstack-kAwddQdu.js";import{HTMLMediaProvider as p}from"./vidstack-html-BCLs1zTg.js";import{H as l}from"../chunks/vidstack-otaI3iyw.js";import{T as P}from"../chunks/vidstack-8CbyOZzp.js";import"../chunks/vidstack-CXmpN6cA.js";import"../chunks/vidstack-Bxv1Qnxe.js";import"../chunks/vidstack-C_AxqLKV.js";class f{#t;#i;constructor(t,e){this.#t=t,this.#i=e,t.textTracks.onaddtrack=this.#e.bind(this),r(this.#s.bind(this))}#e(t){}#s(){this.#t.textTracks.onaddtrack=null;for(const t of this.#i.textTracks){const e=t[P.native]?.track;e?.oncuechange&&(e.oncuechange=null)}}}class m{#t;#i;constructor(t,e){this.#t=t,this.#i=e,new c(t).add("enterpictureinpicture",this.#e.bind(this)).add("leavepictureinpicture",this.#s.bind(this))}get active(){return document.pictureInPictureElement===this.#t}get supported(){return n(this.#t)}async enter(){return this.#t.requestPictureInPicture()}exit(){return document.exitPictureInPicture()}#e(t){this.#r(!0,t)}#s(t){this.#r(!1,t)}#r=(t,e)=>{this.#i.notify("picture-in-picture-change",t,e)}}class g{#t;#i;#e="inline";get mode(){return this.#e}constructor(t,e){this.#t=t,this.#i=e,a(t,"webkitpresentationmodechanged",this.#s.bind(this))}get supported(){return o(this.#t)}async setPresentationMode(t){this.#e!==t&&this.#t.webkitSetPresentationMode(t)}#s(t){const e=this.#e;this.#e=this.#t.webkitPresentationMode,this.#i.player?.dispatch(new u("video-presentation-change",{detail:this.#e,trigger:t})),["fullscreen","picture-in-picture"].forEach(i=>{(this.#e===i||e===i)&&this.#i.notify(`${i}-change`,this.#e===i,t)})}}class v{#t;get active(){return this.#t.mode==="fullscreen"}get supported(){return this.#t.supported}constructor(t){this.#t=t}async enter(){this.#t.setPresentationMode("fullscreen")}async exit(){this.#t.setPresentationMode("inline")}}class x{#t;get active(){return this.#t.mode==="picture-in-picture"}get supported(){return this.#t.supported}constructor(t){this.#t=t}async enter(){this.#t.setPresentationMode("picture-in-picture")}async exit(){this.#t.setPresentationMode("inline")}}class y extends p{$$PROVIDER_TYPE="VIDEO";get type(){return"video"}airPlay;fullscreen;pictureInPicture;constructor(t,e){super(t,e),h(()=>{if(this.airPlay=new l(t,e),o(t)){const i=new g(t,e);this.fullscreen=new v(i),this.pictureInPicture=new x(i)}else n(t)&&(this.pictureInPicture=new m(t,e))},this.scope)}setup(){super.setup(),d(this.video)&&new f(this.video,this.ctx),this.ctx.textRenderers.attachVideo(this.video),r(()=>{this.ctx.textRenderers.attachVideo(null)}),this.type==="video"&&this.ctx.notify("provider-setup",this)}get video(){return this.media}}export{y as VideoProvider};
